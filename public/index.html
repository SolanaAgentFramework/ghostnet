<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Privacy Transfer - Anonymous Transactions</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <!-- config.js is now merged into app.js (obfuscated) -->
    <!-- View Real Flow: <a href="/diagram.html" style="color: #00ff00;">See Actual Transaction Flow</a> -->
</head>
<body>
    <div class="container">
        <header>
            <h1>üîí Solana Privacy Transfer</h1>
            <p class="subtitle">Next-generation anonymous transactions with quantum-safe encryption</p>
        </header>

        <div class="main-content">
            <!-- Wallet Connection Section -->
            <div class="card">
                <h2>Wallet Connection</h2>
                <div class="wallet-section">
                    <button id="connectWallet" class="btn btn-primary">
                        Connect Phantom Wallet
                    </button>
                    <div id="walletInfo" class="wallet-info hidden">
                        <p><strong>Connected:</strong> <span id="walletAddress"></span></p>
                        <p><strong>Balance:</strong> <span id="walletBalance">0 SOL</span></p>
                        <button id="disconnectWallet" class="btn" style="margin-top: 10px; background: transparent; color: #ff0055; border: 1px solid #ff0055; padding: 10px 20px; font-size: 0.9em;">
                            DISCONNECT
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transfer Form -->
            <div class="card">
                <h2>Anonymous Transfer</h2>
                <form id="transferForm">
                    <div class="form-group">
                        <label for="destinationAddress">Destination Address (Wallet B)</label>
                        <input 
                            type="text" 
                            id="destinationAddress" 
                            placeholder="Enter Solana wallet address"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount (SOL)</label>
                        <input 
                            type="number" 
                            id="amount" 
                            step="0.000000001"
                            min="0.003"
                            placeholder="0.003 (minimum)"
                            required
                        >
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Minimum: 0.003 SOL to cover service costs
                        </small>
                    </div>
                    <div class="fee-info">
                        <p>Service Fee: <span id="serviceFee">0.35%</span></p>
                        <p>Total (including fees): <span id="totalAmount">0.0 SOL</span></p>
                    </div>
                    <button type="submit" id="sendButton" class="btn btn-success" disabled>
                        Send Anonymous Transfer
                    </button>
                </form>
            </div>

            <!-- Devnet Warning Banner -->
            <div class="card" style="border-color: #ffaa00; background: rgba(255, 170, 0, 0.05); margin-bottom: 25px;">
                <div style="text-align: center;">
                    <h2 style="color: #ffaa00; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 3px;">
                        ‚ö†Ô∏è DEVNET TEST PAGE ‚ö†Ô∏è
                    </h2>
                    <p style="color: #ffaa00; font-family: var(--font-code); font-size: 1.1em; margin: 0;">
                        üö∞ FAUCET GIVES <strong>DEVNET SOL ONLY</strong> üö∞
                    </p>
                    <p style="color: #aaa; font-size: 0.9em; margin-top: 10px;">
                        This is a testing environment. All transactions are on Solana Devnet.
                    </p>
                    <p style="margin-top: 15px;">
                        <a href="/tutorial.html" style="color: var(--neon-green); text-decoration: underline; font-family: var(--font-code);">
                            üìö Don't know how to switch Phantom to Devnet? Click here for tutorial! üé•
                        </a>
                    </p>
                </div>
            </div>

            <!-- Devnet Faucet Section -->
            <div class="card" style="border-color: var(--neon-green);">
                <h2>üö∞ Devnet Faucet</h2>
                <p style="color: #aaa; margin-bottom: 15px;">
                    Get 0.02 DEVNET SOL for testing (Rate limit: 1 hour per IP/wallet)
                    <br>
                    <a href="/tutorial.html" style="color: var(--neon-blue); text-decoration: underline; font-size: 0.9em;">
                        üìñ New to Devnet? Read the tutorial
                    </a>
                </p>
                
                <div id="faucetWalletInfo" class="wallet-info hidden" style="margin-bottom: 20px;">
                    <p style="margin: 5px 0;"><strong>Connected Wallet:</strong> <span id="faucetWalletAddress" style="color: var(--neon-green); font-family: var(--font-code);"></span></p>
                </div>
                
                <div id="faucetNotConnected" style="padding: 15px; background: rgba(255, 0, 85, 0.1); border: 1px solid #ff0055; border-radius: 2px; margin-bottom: 15px;">
                    <p style="color: #ff0055; margin: 0; font-family: var(--font-code);">
                        ‚ö†Ô∏è Connect your Phantom wallet first to use the faucet!
                    </p>
                </div>
                
                <button id="faucetButton" onclick="requestAirdrop()" class="btn btn-success" style="width: 100%; font-size: 1.2em; font-weight: bold;" disabled>
                    üéÅ GIMME 0.02 DEVNET SOL üéÅ
                </button>
                <p id="faucetStatus" style="color: var(--neon-green); margin-top: 15px; font-family: var(--font-code); font-size: 0.9em; min-height: 20px;"></p>
            </div>

            <!-- Privacy Animation Section -->
            <div class="card hidden" id="animationCard">
                <h2>Privacy Processing</h2>
                <div class="privacy-animation">
                    <div class="animation-stage" id="stage1">
                        <div class="privacy-level-badge">Level 1</div>
                        <div class="glitch-overlay"></div>
                        <div class="node-container">
                            <div class="privacy-node active">
                                <div class="node-pulse"></div>
                            </div>
                            <div class="privacy-node">
                                <div class="node-pulse"></div>
                            </div>
                            <div class="privacy-node">
                                <div class="node-pulse"></div>
                            </div>
                        </div>
                        <div class="connection-lines">
                            <div class="connection-line"></div>
                            <div class="connection-line"></div>
                        </div>
                        <p class="stage-text">Initializing Privacy Nodes...</p>
                        <p class="stage-subtext">Activating 3 distributed privacy nodes across global network</p>
                    </div>
                    <div class="animation-stage hidden" id="stage2">
                        <div class="privacy-level-badge">Level 2</div>
                        <div class="relay-container">
                            <div class="relay-line">
                                <div class="data-packet"></div>
                            </div>
                            <div class="relay-node">
                                <div class="relay-core"></div>
                            </div>
                            <div class="relay-line">
                                <div class="data-packet"></div>
                            </div>
                        </div>
                        <div class="relay-network">
                            <div class="network-node"></div>
                            <div class="network-node"></div>
                            <div class="network-node"></div>
                        </div>
                        <p class="stage-text">Routing Through Secure Relays...</p>
                        <p class="stage-subtext">Establishing encrypted relay connections through 12+ nodes</p>
                    </div>
                    <div class="animation-stage hidden" id="stage3">
                        <div class="privacy-level-badge">Level 3</div>
                        <div class="encryption-container">
                            <div class="encryption-layers">
                                <div class="encryption-layer">
                                    <div class="encryption-pattern"></div>
                                </div>
                                <div class="encryption-layer">
                                    <div class="encryption-pattern"></div>
                                </div>
                                <div class="encryption-layer">
                                    <div class="encryption-pattern"></div>
                                </div>
                            </div>
                            <div class="quantum-particles">
                                <div class="quantum-particle"></div>
                                <div class="quantum-particle"></div>
                                <div class="quantum-particle"></div>
                                <div class="quantum-particle"></div>
                            </div>
                        </div>
                        <p class="stage-text">Applying Quantum-Safe Encryption...</p>
                        <p class="stage-subtext">Multi-layer encryption protocol engaged ‚Ä¢ AES-256 + Post-Quantum algorithms</p>
                    </div>
                    <div class="animation-stage hidden" id="stage7">
                        <div class="privacy-level-badge">Level 4</div>
                        <div class="mixing-animation">
                            <div class="mix-node"></div>
                            <div class="mix-node"></div>
                            <div class="mix-node"></div>
                            <div class="mix-connection"></div>
                            <div class="mix-connection"></div>
                        </div>
                        <p class="stage-text">Transaction Mixing Protocol...</p>
                        <p class="stage-subtext">Obfuscating transaction trail through mixing pool</p>
                    </div>
                    <div class="animation-stage hidden" id="stage4">
                        <div class="privacy-level-badge">Level 5</div>
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <p class="stage-text">Finalizing Privacy Layer...</p>
                        <p class="stage-subtext" id="confirmationSubtext">Confirming transaction through privacy network</p>
                        <p class="confirmation-count" id="confirmationCount">Processing... 0/5</p>
                    </div>
                    <div class="animation-stage hidden" id="stage5">
                        <div class="privacy-level-badge">Level 6</div>
                        <div class="reassembly-animation">
                            <div class="particle"></div>
                            <div class="particle"></div>
                            <div class="particle"></div>
                            <div class="particle"></div>
                        </div>
                        <p class="stage-text">Reassembling at Destination...</p>
                        <p class="stage-subtext">Reconstructing funds through privacy network</p>
                    </div>
                    <div class="animation-stage hidden" id="stage8">
                        <div class="privacy-level-badge">Merkle Proof</div>
                        <div class="merkle-container" id="merkleTree"></div>
                        <p class="stage-text">Merkle Tree Verification...</p>
                        <p class="stage-subtext">Building cryptographic proof tree</p>
                    </div>
                    <div class="animation-stage hidden" id="stage6">
                        <div class="success-icon">‚úì</div>
                        <p class="stage-text success">Transfer Complete!</p>
                        <p class="stage-subtext success">Privacy levels: 6/6 achieved</p>
                        <p class="tx-hash" id="txHash"></p>
                    </div>
                </div>
            </div>

            <!-- Classified Protocol Timeline -->
            <div class="card roadmap-section">
                <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #00ff00;">
                    <p style="color: #00ff00; font-size: 14px; margin: 0; text-align: center;">
                        ‚ö†Ô∏è This GitHub page is a proof of concept demonstration
                    </p>
                </div>
                <h2><span class="glitch-text">PROTOCOL_TIMELINE</span></h2>
                
                <div class="roadmap-grid">
                    <div class="roadmap-card active">
                        <h3>PHASE I: GENESIS</h3>
                        <p>‚Ä¢ Ghost Shard Routing [ACTIVE]</p>
                        <p>‚Ä¢ Black Mirror Wallet Integration</p>
                        <p>‚Ä¢ Merkle Verification Layer</p>
                        <div style="margin-top:10px; color: var(--neon-green); font-size: 0.8em;">STATUS: DEPLOYED</div>
                    </div>
                    <div class="roadmap-card locked">
                        <div class="lock-overlay">üîí</div>
                        <h3>PHASE II: [ENCRYPTED]</h3>
                        <div class="redacted-text"></div>
                        <div class="redacted-text" style="width: 60%"></div>
                        <div class="redacted-text" style="width: 90%"></div>
                        <div style="margin-top:10px; color: #555; font-size: 0.8em;">STATUS: PENDING DECRYPTION</div>
                    </div>
                    <div class="roadmap-card locked">
                        <div class="lock-overlay">üîí</div>
                        <h3>PHASE III: [NO SIGNAL]</h3>
                        <div class="redacted-text" style="width: 50%"></div>
                        <div class="redacted-text"></div>
                        <div class="redacted-text" style="width: 70%"></div>
                        <div style="margin-top:10px; color: #555; font-size: 0.8em;">STATUS: CLASSIFIED</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 15px; background: rgba(0,255,0,0.05); border-radius: 8px; border-left: 4px solid var(--neon-green);">
                    <p style="margin: 0; color: var(--neon-green); font-size: 14px; font-family: var(--font-code);">
                        <strong>CLASSIFIED:</strong> Advanced protocols require clearance level 5+. Mathematical proofs of anonymity. Unkillable infrastructure. Zero-knowledge cryptography.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
    <script>
        // Faucet function - uses connected wallet
        async function requestAirdrop() {
            const status = document.getElementById('faucetStatus');
            
            // Get connected wallet address from global variable
            if (typeof walletPublicKey === 'undefined' || !walletPublicKey) {
                status.innerText = "‚ùå Please connect your Phantom wallet first!";
                status.style.color = "#ff0055";
                return;
            }
            
            const address = walletPublicKey.toString();

            status.innerText = "‚è≥ Requesting 0.02 DEVNET SOL...";
            status.style.color = "var(--neon-blue)";

            try {
                const apiUrl = CONFIG.API_URL || 'http://localhost:3000';
                const response = await fetch(`${apiUrl}/api/request-airdrop`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ walletAddress: address })
                });

                const data = await response.json();

                if (data.success) {
                    status.innerHTML = `‚úÖ Sent! <a href="${data.solscan}" target="_blank" style="color: var(--neon-green); text-decoration: underline;">View TX on Solscan</a>`;
                    status.style.color = "var(--neon-green)";
                } else {
                    status.innerText = `‚ùå ${data.error || 'Unknown error'}`;
                    status.style.color = "#ff0055";
                }
            } catch (e) {
                status.innerText = "‚ùå Server error. Is the backend running?";
                status.style.color = "#ff0055";
                console.error('Faucet error:', e);
            }
        }

        // Update faucet UI when wallet connects/disconnects
        function updateFaucetUI() {
            const faucetWalletInfo = document.getElementById('faucetWalletInfo');
            const faucetNotConnected = document.getElementById('faucetNotConnected');
            const faucetButton = document.getElementById('faucetButton');
            const faucetWalletAddress = document.getElementById('faucetWalletAddress');
            
            if (typeof walletPublicKey !== 'undefined' && walletPublicKey) {
                // Wallet connected
                faucetWalletInfo.classList.remove('hidden');
                faucetNotConnected.style.display = 'none';
                faucetButton.disabled = false;
                const addr = walletPublicKey.toString();
                faucetWalletAddress.textContent = `${addr.slice(0, 8)}...${addr.slice(-8)}`;
            } else {
                // Wallet not connected
                faucetWalletInfo.classList.add('hidden');
                faucetNotConnected.style.display = 'block';
                faucetButton.disabled = true;
            }
        }

        // Monitor wallet connection changes
        document.addEventListener('DOMContentLoaded', () => {
            // Check wallet connection periodically
            setInterval(updateFaucetUI, 1000);
            updateFaucetUI();
        });
    </script>
</body>
</html>

