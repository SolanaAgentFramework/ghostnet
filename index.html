<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol: GHOST</title>
    
    <!-- Signal Jammer Meta Data Pack - Social Camouflage -->
    <meta name="description" content="PROTOCOL: ENCRYPTED // STATUS: ACTIVE. Zero-trace Solana routing architecture.">
    <meta name="theme-color" content="#00f3ff">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="DEAD_DROP // ACCESS_POINT">
    <meta name="twitter:description" content="> ESTABLISHING SECURE CONNECTION... > GHOST SHARDS: ACTIVE">
    <meta name="twitter:image" content="https://solanaagentframework.github.io/dead_drop/og-image.png">
    
    <!-- Open Graph (Facebook, Discord, Telegram, etc.) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="SOLANA PRIVACY [CLASSIFIED]">
    <meta property="og:description" content="Next-generation anonymity protocol. Mixing pools and ghost routing active.">
    <meta property="og:url" content="https://solanaagentframework.github.io/dead_drop/">
    <meta property="og:site_name" content="DEAD_DROP">
    <meta property="og:image" content="https://solanaagentframework.github.io/dead_drop/og-image.png">
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <!-- config.js is now merged into app.js (obfuscated) -->
</head>
<body>

    <div class="hud-corner tl"></div>
    <div class="hud-corner tr"></div>
    <div class="hud-corner bl"></div>
    <div class="hud-corner br"></div>
    <div class="scanline"></div>

    <div class="hud-container">
        
        <header>
            <h1>PROTOCOL<br>DEAD_DROP</h1>
            <div class="subtitle">SECURE SOLANA TRANSMISSION</div>
        </header>

        <!-- Devnet Warning -->
        <div class="warning-banner" style="margin-bottom: 30px;">
            <h2 style="font-size: 1em; margin-bottom: 10px;">‚ö†Ô∏è DEVNET TEST PAGE ‚ö†Ô∏è</h2>
            <p style="color: #ffaa00; font-size: 0.9em; margin: 5px 0;">
                üö∞ FAUCET GIVES <strong>DEVNET SOL ONLY</strong> üö∞
            </p>
            <p style="color: rgba(255,255,255,0.5); font-size: 0.8em; margin-top: 10px;">
                This is a testing environment. All transactions are on Solana Devnet.
            </p>
            <p style="margin-top: 10px;">
                <a href="tutorial.html" style="color: var(--holo-blue); font-size: 0.85em;">
                    üìö Don't know how to switch Phantom to Devnet? Click here for tutorial! üé•
                </a>
            </p>
        </div>

        <div id="walletSection">
            <button id="connectWallet" class="btn">INITIALIZE UPLINK</button>
            
            <div id="walletInfo" class="hidden">
                LINK: <span class="status-connected">ACTIVE</span><br>
                ID: <span id="walletAddress" style="font-family: monospace;">...</span><br>
                AMMO: <span id="walletBalance">...</span>
                <button id="disconnectWallet" class="btn btn-danger" style="margin-top: 10px; width: auto; padding: 8px 20px; font-size: 0.9em;">DISCONNECT</button>
            </div>
        </div>

        <form id="transferForm" style="margin-top: 50px; width: 100%;">
            
            <div class="form-group">
                <label>// TARGET DESTINATION</label>
                <input type="text" id="destinationAddress" placeholder="PASTE_ENCRYPTED_ADDRESS_HERE" autocomplete="off" required>
            </div>

            <div class="form-group">
                <label>// QUANTITY</label>
                <input type="number" id="amount" step="0.000000001" min="0.003" placeholder="0.00 SOL" required>
                <small>Minimum: 0.003 SOL to cover service costs</small>
            </div>

            <div class="fee-info">
                FEE: <span id="serviceFee">0.00</span> | TOTAL: <span id="totalAmount">0.00</span>
            </div>

            <button type="submit" id="sendButton" class="btn btn-success" disabled>EXECUTE</button>
        </form>

        <!-- Devnet Faucet Section -->
        <div class="faucet-container" style="margin-top: 40px; width: 100%;">
            <h2 style="font-size: 1.2em; margin-bottom: 15px;">üö∞ DEVNET FAUCET</h2>
            <p style="color: rgba(255,255,255,0.6); margin-bottom: 15px; font-size: 0.85em;">
                Get 0.02 DEVNET SOL for testing (Rate limit: 1 hour per IP/wallet)
                <br>
                <a href="tutorial.html" style="color: var(--holo-blue); font-size: 0.85em;">
                    üìñ New to Devnet? Read the tutorial
                </a>
            </p>
            
            <div id="faucetWalletInfo" class="wallet-info hidden" style="margin-bottom: 20px;">
                <p style="margin: 5px 0;">Connected Wallet: <span id="faucetWalletAddress" style="color: var(--holo-yellow); font-family: monospace;"></span></p>
            </div>
            
            <div id="faucetNotConnected" style="padding: 15px; background: rgba(255, 0, 85, 0.1); border: 1px solid var(--holo-red); margin-bottom: 15px; text-align: left;">
                <p style="color: var(--holo-red); margin: 0; font-size: 0.85em;">
                    ‚ö†Ô∏è Connect your Phantom wallet first to use the faucet!
                </p>
            </div>
            
            <button id="faucetButton" onclick="requestAirdrop()" class="btn btn-success" style="font-size: 1.1em; font-weight: bold;" disabled>
                üéÅ GIMME 0.02 DEVNET SOL üéÅ
            </button>
            <p id="faucetStatus" style="margin-top: 15px; min-height: 20px;"></p>
        </div>

        <div id="animationCard" class="hidden" style="margin-top: 30px; width: 100%;">
            <div id="stage1" class="stage-text" style="color: var(--holo-blue);">PROCESSING...</div>
            
            <div id="stage2" class="stage-text hidden">RELAY ACTIVE...</div>
            <div id="stage3" class="stage-text hidden">ENCRYPTING...</div>
            <div id="stage4" class="stage-text hidden">MIXING...</div>
            <div id="stage5" class="stage-text hidden">VERIFYING...</div>
            <div id="stage6" class="stage-text hidden" style="color: var(--holo-green);">TRANSFER COMPLETE</div>
            
            <div id="progressBar" style="height: 2px; background: var(--holo-blue); width: 0%; margin-top: 10px; box-shadow: 0 0 10px var(--holo-blue);"></div>
            
            <div id="txHash" style="margin-top: 10px; font-size: 0.7em; color: var(--holo-blue); word-break: break-all; font-family: monospace;"></div>
            
            <!-- Additional stages for compatibility -->
            <div class="hidden" id="stage7"></div>
            <div class="hidden" id="stage8"></div>
        </div>

        <!-- Protocol Timeline -->
        <div style="margin-top: 50px; width: 100%; text-align: left;">
            <h2 style="font-size: 1em; margin-bottom: 15px; text-align: center;">PROTOCOL_TIMELINE</h2>
            <div style="background: rgba(0,0,0,0.3); border: 1px solid var(--holo-blue); padding: 15px; margin-bottom: 15px;">
                <h3 style="color: var(--holo-blue); margin-bottom: 10px; font-size: 0.9em;">PHASE I: GENESIS</h3>
                <p style="font-size: 0.8em; margin: 3px 0;">‚Ä¢ Ghost Shard Routing [ACTIVE]</p>
                <p style="font-size: 0.8em; margin: 3px 0;">‚Ä¢ Black Mirror Wallet Integration</p>
                <p style="font-size: 0.8em; margin: 3px 0;">‚Ä¢ Merkle Verification Layer</p>
                <div style="margin-top:10px; color: var(--holo-green); font-size: 0.75em;">STATUS: DEPLOYED</div>
            </div>
            <div style="background: rgba(0,0,0,0.3); border: 1px solid #555; padding: 15px; margin-bottom: 15px; opacity: 0.7;">
                <h3 style="color: #555; margin-bottom: 10px; font-size: 0.9em;">PHASE II: [ENCRYPTED]</h3>
                <div style="background: #222; height: 0.8em; width: 80%; margin-bottom: 5px;"></div>
                <div style="background: #222; height: 0.8em; width: 60%; margin-bottom: 5px;"></div>
                <div style="background: #222; height: 0.8em; width: 90%; margin-bottom: 5px;"></div>
                <div style="margin-top:10px; color: #555; font-size: 0.75em;">STATUS: PENDING DECRYPTION</div>
            </div>
            <div style="background: rgba(0,0,0,0.3); border: 1px solid #555; padding: 15px; opacity: 0.7;">
                <h3 style="color: #555; margin-bottom: 10px; font-size: 0.9em;">PHASE III: [NO SIGNAL]</h3>
                <div style="background: #222; height: 0.8em; width: 50%; margin-bottom: 5px;"></div>
                <div style="background: #222; height: 0.8em; width: 100%; margin-bottom: 5px;"></div>
                <div style="background: #222; height: 0.8em; width: 70%; margin-bottom: 5px;"></div>
                <div style="margin-top:10px; color: #555; font-size: 0.75em;">STATUS: CLASSIFIED</div>
            </div>
        </div>
        
        <div style="margin-top: 40px; text-align: center; opacity: 0.5; font-size: 0.7em;">
            GITHUB PAGES DEPLOYMENT // DEVNET ONLY
        </div>

    </div>

    <script src="app.js"></script>
    <script>
        // Faucet function - uses connected wallet
        async function requestAirdrop() {
            const status = document.getElementById('faucetStatus');
            
            // Get connected wallet address from global variable
            if (typeof walletPublicKey === 'undefined' || !walletPublicKey) {
                status.innerText = "‚ùå Please connect your Phantom wallet first!";
                status.style.color = "#ff0055";
                return;
            }
            
            const address = walletPublicKey.toString();

            status.innerText = "‚è≥ Requesting 0.02 DEVNET SOL...";
            status.style.color = "var(--holo-blue)";

            try {
                const apiUrl = CONFIG.API_URL || 'http://localhost:3000';
                const response = await fetch(`${apiUrl}/api/request-airdrop`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ walletAddress: address })
                });

                const data = await response.json();

                if (data.success) {
                    status.innerHTML = `‚úÖ Sent! <a href="${data.solscan}" target="_blank" style="color: var(--holo-yellow); text-decoration: underline;">View TX on Solscan</a>`;
                    status.style.color = "var(--holo-yellow)";
                } else {
                    status.innerText = `‚ùå ${data.error || 'Unknown error'}`;
                    status.style.color = "#ff0055";
                }
            } catch (e) {
                status.innerText = "‚ùå Server error. Is the backend running?";
                status.style.color = "#ff0055";
                console.error('Faucet error:', e);
            }
        }

        // Update faucet UI when wallet connects/disconnects
        function updateFaucetUI() {
            const faucetWalletInfo = document.getElementById('faucetWalletInfo');
            const faucetNotConnected = document.getElementById('faucetNotConnected');
            const faucetButton = document.getElementById('faucetButton');
            const faucetWalletAddress = document.getElementById('faucetWalletAddress');
            
            if (typeof walletPublicKey !== 'undefined' && walletPublicKey) {
                // Wallet connected
                faucetWalletInfo.classList.remove('hidden');
                faucetNotConnected.style.display = 'none';
                faucetButton.disabled = false;
                const addr = walletPublicKey.toString();
                faucetWalletAddress.textContent = `${addr.slice(0, 8)}...${addr.slice(-8)}`;
            } else {
                // Wallet not connected
                faucetWalletInfo.classList.add('hidden');
                faucetNotConnected.style.display = 'block';
                faucetButton.disabled = true;
            }
        }

        // Monitor wallet connection changes
        document.addEventListener('DOMContentLoaded', () => {
            // Check wallet connection periodically
            setInterval(updateFaucetUI, 1000);
            updateFaucetUI();
        });
    </script>
</body>
</html>
